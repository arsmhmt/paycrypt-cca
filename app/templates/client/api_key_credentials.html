{% extends "client/base.html" %}

{% block title %}API Credentials - {{ api_key.name }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0">
                <i class="fas fa-key text-primary"></i> API Integration Credentials
            </h1>
            <p class="text-muted">Complete API credentials for "{{ api_key.name }}"</p>
        </div>
        <a href="{{ url_for('client.api_keys') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Back to API Keys
        </a>
    </div>

    <!-- Security Alert -->
    <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle"></i>
        <strong>Security Notice:</strong> These credentials provide access to your account. Keep them secure and never share them publicly.
    </div>

    <!-- API Credentials Cards -->
    <div class="row">
        <!-- API Key -->
        <div class="col-md-6 mb-4">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-key"></i> API Key
                    </h5>
                </div>
                <div class="card-body">
                    <label class="form-label"><strong>PAYCRYPT_API_KEY</strong></label>
                    <div class="input-group">
                        <input type="password" class="form-control font-monospace" 
                               id="apiKey" value="{{ api_key.key }}" readonly>
                        <button class="btn btn-outline-secondary" type="button" onclick="toggleVisibility('apiKey', 'eyeIcon1')">
                            <i class="fas fa-eye" id="eyeIcon1"></i>
                        </button>
                        <button class="btn btn-outline-primary" type="button" onclick="copyToClipboard('{{ api_key.key }}', 'API Key')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="form-text mt-2">
                        Use this in the <code>Authorization</code> header: <code>Bearer {{ api_key.key[:12] }}...</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secret Key -->
        <div class="col-md-6 mb-4">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-shield-alt"></i> Secret Key
                    </h5>
                </div>
                <div class="card-body">
                    <label class="form-label"><strong>PAYCRYPT_SECRET_KEY</strong></label>
                    <div class="input-group">
                        <input type="password" class="form-control font-monospace" 
                               id="secretKey" value="{{ api_key.secret_key }}" readonly>
                        <button class="btn btn-outline-secondary" type="button" onclick="toggleVisibility('secretKey', 'eyeIcon2')">
                            <i class="fas fa-eye" id="eyeIcon2"></i>
                        </button>
                        <button class="btn btn-outline-success" type="button" onclick="copyToClipboard('{{ api_key.secret_key }}', 'Secret Key')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="form-text">
                        Used for request signing and enhanced security validation
                    </div>
                </div>
            </div>
        </div>

        <!-- Webhook Secret -->
        <div class="col-md-6 mb-4">
            <div class="card border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-webhook"></i> Webhook Secret
                    </h5>
                </div>
                <div class="card-body">
                    <label class="form-label"><strong>PAYCRYPT_WEBHOOK_SECRET</strong></label>
                    <div class="input-group">
                        <input type="password" class="form-control font-monospace" 
                               id="webhookSecret" value="{{ api_key.webhook_secret }}" readonly>
                        <button class="btn btn-outline-secondary" type="button" onclick="toggleVisibility('webhookSecret', 'eyeIcon3')">
                            <i class="fas fa-eye" id="eyeIcon3"></i>
                        </button>
                        <button class="btn btn-outline-warning" type="button" onclick="copyToClipboard('{{ api_key.webhook_secret }}', 'Webhook Secret')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="form-text">
                        Used to verify webhook payloads for security
                    </div>
                </div>
            </div>
        </div>

        <!-- Base URL -->
        <div class="col-md-6 mb-4">
            <div class="card border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-globe"></i> Base URL
                    </h5>
                </div>
                <div class="card-body">
                    <label class="form-label"><strong>PAYCRYPT_BASE_URL</strong></label>
                    <div class="input-group">
                        <input type="text" class="form-control font-monospace" 
                               id="baseUrl" value="{{ base_url }}" readonly>
                        <button class="btn btn-outline-info" type="button" onclick="copyToClipboard('{{ base_url }}', 'Base URL')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="form-text">
                        The base URL for all API endpoints
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Environment Variables Section -->
    <div class="card mt-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-code"></i> Environment Variables (Copy All)
            </h5>
        </div>
        <div class="card-body">
            <pre class="bg-dark text-light p-3 rounded" id="envVars">PAYCRYPT_API_KEY={{ api_key.key }}
PAYCRYPT_SECRET_KEY={{ api_key.secret_key }}
PAYCRYPT_WEBHOOK_SECRET={{ api_key.webhook_secret }}
PAYCRYPT_BASE_URL={{ base_url }}</pre>
            <button class="btn btn-primary mt-2" onclick="copyToClipboard(document.getElementById('envVars').textContent, 'Environment Variables')">
                <i class="fas fa-copy"></i> Copy All Environment Variables
            </button>
        </div>
    </div>

    <!-- Usage Examples -->
    <div class="card mt-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-code"></i> Usage Examples
            </h5>
        </div>
        <div class="card-body">
            <!-- PHP Example -->
            <h6 class="text-primary"><i class="fab fa-php"></i> PHP Example</h6>
            <pre class="bg-light p-3 rounded"><code>$curl = curl_init();
curl_setopt_array($curl, [
    CURLOPT_URL => "{{ base_url }}/payments",
    CURLOPT_RETURNTRANSFER => true,
    CURLOPT_HTTPHEADER => [
        "Authorization: Bearer {{ api_key.key[:12] }}...",
        "Content-Type: application/json",
        "X-Secret-Key: {{ api_key.secret_key[:12] }}..."
    ],
    CURLOPT_POSTFIELDS => json_encode([
        "amount" => 100.00,
        "currency" => "USDT"
    ])
]);
$response = curl_exec($curl);</code></pre>

            <!-- JavaScript Example -->
            <h6 class="text-success mt-4"><i class="fab fa-js"></i> JavaScript Example</h6>
            <pre class="bg-light p-3 rounded"><code>const response = await fetch('{{ base_url }}/payments', {
    method: 'POST',
    headers: {
        'Authorization': 'Bearer {{ api_key.key[:12] }}...',
        'Content-Type': 'application/json',
        'X-Secret-Key': '{{ api_key.secret_key[:12] }}...'
    },
    body: JSON.stringify({
        amount: 100.00,
        currency: 'USDT'
    })
});
const data = await response.json();</code></pre>

            <!-- Python Example -->
            <h6 class="text-warning mt-4"><i class="fab fa-python"></i> Python Example</h6>
            <pre class="bg-light p-3 rounded"><code>import requests

headers = {
    'Authorization': 'Bearer {{ api_key.key[:12] }}...',
    'Content-Type': 'application/json',
    'X-Secret-Key': '{{ api_key.secret_key[:12] }}...'
}

data = {
    'amount': 100.00,
    'currency': 'USDT'
}

response = requests.post('{{ base_url }}/payments', 
                        json=data, headers=headers)</code></pre>
        </div>
    </div>

    <!-- API Key Information -->
    <div class="card mt-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-info-circle"></i> API Key Information
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4">Name:</dt>
                        <dd class="col-sm-8">{{ api_key.name }}</dd>

                        <dt class="col-sm-4">Type:</dt>
                        <dd class="col-sm-8">
                            {% if api_key.client_type == 'flat_rate' %}
                            <span class="badge bg-success">Enterprise Flat Rate</span>
                            {% else %}
                            <span class="badge bg-primary">Commission Based</span>
                            {% endif %}
                        </dd>

                        <dt class="col-sm-4">Status:</dt>
                        <dd class="col-sm-8">
                            {% if api_key.is_active %}
                            <span class="badge bg-success">Active</span>
                            {% else %}
                            <span class="badge bg-danger">Revoked</span>
                            {% endif %}
                        </dd>

                        <dt class="col-sm-4">Rate Limit:</dt>
                        <dd class="col-sm-8">{{ api_key.rate_limit }} requests/minute</dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4">Created:</dt>
                        <dd class="col-sm-8">{{ api_key.created_at.strftime('%Y-%m-%d %H:%M') }}</dd>

                        <dt class="col-sm-4">Usage Count:</dt>
                        <dd class="col-sm-8">{{ api_key.usage_count or 0 }}</dd>

                        {% if api_key.expires_at %}
                        <dt class="col-sm-4">Expires:</dt>
                        <dd class="col-sm-8">{{ api_key.expires_at.strftime('%Y-%m-%d') }}</dd>
                        {% endif %}

                        {% if api_key.last_used_at %}
                        <dt class="col-sm-4">Last Used:</dt>
                        <dd class="col-sm-8">{{ api_key.last_used_at.strftime('%Y-%m-%d %H:%M') }}</dd>
                        {% endif %}
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <!-- Security Guidelines -->
    <div class="card mt-4 border-danger">
        <div class="card-header bg-danger text-white">
            <h5 class="card-title mb-0">
                <i class="fas fa-exclamation-triangle"></i> Security Guidelines
            </h5>
        </div>
        <div class="card-body">
            <ul class="mb-0">
                <li><strong>Never expose these credentials</strong> in client-side code, public repositories, or logs</li>
                <li><strong>Store securely</strong> in environment variables or secure configuration files</li>
                <li><strong>Rotate regularly</strong> - regenerate keys periodically for enhanced security</li>
                <li><strong>Monitor usage</strong> - watch for suspicious activity in your API logs</li>
                <li><strong>Use HTTPS only</strong> - never send credentials over unencrypted connections</li>
                <li><strong>Restrict IP access</strong> if possible - limit API access to known server IPs</li>
            </ul>
        </div>
    </div>
</div>

<script>
function toggleVisibility(inputId, iconId) {
    const input = document.getElementById(inputId);
    const icon = document.getElementById(iconId);
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.className = 'fas fa-eye-slash';
    } else {
        input.type = 'password';
        icon.className = 'fas fa-eye';
    }
}

function copyToClipboard(text, label) {
    navigator.clipboard.writeText(text).then(function() {
        // Show success message
        showToast(`${label} copied to clipboard!`, 'success');
    }, function(err) {
        console.error('Could not copy text: ', err);
        showToast('Failed to copy to clipboard', 'error');
    });
}

function showToast(message, type) {
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `alert alert-${type === 'success' ? 'success' : 'danger'} position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
        ${message}
    `;
    
    document.body.appendChild(toast);
    
    // Remove after 3 seconds
    setTimeout(() => {
        document.body.removeChild(toast);
    }, 3000);
}
</script>
{% endblock %}
